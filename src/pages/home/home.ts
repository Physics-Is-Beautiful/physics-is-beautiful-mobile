import { Component, ViewChild } from "@angular/core";
import { DomSanitizer, SafeUrl } from "@angular/platform-browser";
import { NavController, Platform } from "ionic-angular";
import { GlobalSettingsProvider } from "../../providers/global-settings/global-settings";

@Component({
  selector: "page-home",
  templateUrl: "home.html",
})
export class HomePage {

  public node: string = "/curriculum?pib_mobile=true";

  // Page URL is generated by appending the node to the global site URL.
  public pageUrl: SafeUrl;

  @ViewChild("mainObject") public mainObject: any;
  public mainObjectElement: any;

  constructor(public navCtrl: NavController, public platform: Platform,
              public globalSettingsProvider: GlobalSettingsProvider, private sanitizer: DomSanitizer) {

    const backAction =  platform.registerBackButtonAction(() => {
      this.mainObjectElement.contentWindow.postMessage("goBack", "*");
      console.log("second");
      backAction();
    }, 2);

    const siteUrl = globalSettingsProvider.siteUrl();
    const url = siteUrl + this.node;
    this.pageUrl = this.sanitizer.bypassSecurityTrustResourceUrl(url);

    window.addEventListener("message", (event) => {
      if (event.data === "pagePushed") {
        console.log("pagePushed");
      }
    });
  }

  public ngAfterViewInit() {
    this.mainObjectElement = this.mainObject.nativeElement;
  }
}
